{"version":3,"sources":["consts/colors.js","utils/data.js","getData.js","components/CountrySelect.jsx","components/Header.jsx","components/NestedBoxes.jsx","components/Charts.jsx","components/HomePage.jsx","components/Dictionary.jsx","components/App.jsx","index.jsx","utils/display.js","consts/data.js"],"names":["themePrimary","sand","themeSecondary","indigo","headerColor","gold","colorGroups","orange","grass","plum","tomato","sky","brown","violet","fillIntensity","strokeIntensity","radColors","red","crimson","pink","purple","blue","cyan","teal","green","mint","lime","yellow","amber","gray","mauve","slate","sage","olive","bronze","getRC","radColor","idx","Object","keys","replace","SPECIAL_FILTERS_MAP","_NONE_","_","negate","identity","_SOMETHING_","_ANY_","stubTrue","defaultCompFn","cellVal","filterVal","toLowerCase","getUrl","gid","configParser","row","C","chartId","each","value","key","filterByCountryGenerator","selectedIso","D","country_iso_code","getElements","chartConfig","filter","k","S","all","startsWith","_key_","getSetting","element","chartConfigsMap","field","get","getField","getFieldBoolean","getFormula","formula","getBounds","value_lower","vLower","value_upper","vUpper","parseFloat","getColors","chartSettings","chartElements","visibleElements","groupIdx","parseInt","Math","abs","colorOverride","length","baseColors","colors","map","chartType","push","transformYearRange","range","result","exec","y1","y2","String","getFilter","year","allChartsFilter","allElementsFilter","elementFilter","backupFilters","getRow","chartSourceData","matchingRows","every","maxBy","r","Number","sourceYear","getDataPoint","valueField","displayName","set","G","DISPLAY_NAME","capAndFormat","displayValue","percentage","options","cap","capPercentage","decimals","percentageDecimals","displayPercent","capValue","forEach","F","v","toUpperCase","cv","coarseFormatting","coarseIntegerFormatting","displayNumber","DISPLAY_VALUE","getCalculatedDataPoint","dataPoints","rawFormula","convertedFormula","eval","error","console","warn","test","isNumber","memoizedGetAllDataFromTab","memoize","async","csv","catch","e","getCharts","chartIds","Promise","_page_element_","elementConfig","elementSettings","text","elementId","type","getPageElement","includes","sourceGid","d","getCountryDataFromTab","getterMap","table","getTable","table_list","getTableList","getText","getChart","getter","getChartOrTable","elements","textValues","countryIso","name","hiddenUntilExpand","chartWideConfig","colNames","f","some","REGEX","rgx","colorMap","_color_by_","reduce","accum","KVPairToBeColored","split","color","data","i","rowName","values","cn","LCVal","chartWideFieldVal","columnName","columnNamed","sheetRow","hideRowNames","isPercentage","rowNames","uniq","elem","TABLE_DELIN","rn","hidden","year_range","isTimeseries","years_arr","elementNameMap","getSiteData","CONFIGURABLE_GID_NAMES","GID_MAP","homeRows","home","lastConfiguredRow","findLast","setConfigGids","cmsData","CMS_SHEETS","sheetName","baseConfigs","configs","shaped","groupBy","uniqBy","c","chart_id","id","mapValues","configParams","elemDetails","elementName","getChartConfigs","log","PRE_LOAD_DATA","config","CountrySelect","handleCountryChange","countries","FormControl","sx","width","marginTop","marginBottom","InputLabel","Select","labelId","label","onChange","MenuItem","iso","Header","Box","flexGrow","AppBar","position","background","Toolbar","BUFFER_RATIO","TEXT_BUFFER_RATIO","DEFAULT_RATIO","FONT_SIZE_RATIO","HEADER_FONT_SIZE_RATIO","LINE_HEIGHT","CAP_VALUE","innerTextGetter","ratio","round","NestedBoxes","ratios","fillColors","textColors","content","firstSide","horizontal","classes","getInnerText","bufferRatio","textBufferRatio","defaultRatio","fontSizeRatio","headerFontSizeRatio","lineHeight","resolveOrientation","v1","v2","bufferDistance","textBufferDistance","side","x","y","fontSize","headerFontSize","rects","texts","connectingLines","innerText","colorOuter","colorInner","textColor","height","fill","below","className","style","txt","j","dy","nextSide","borderWidth","lineStyle","strokeWidth","strokeDasharray","line1","stroke","x1","x2","line2","totalX","totalY","totalXh","totalYh","classNames","viewBox","CustomTooltip","active","payload","isArea","payloads","sortBy","source","p","reverse","dataKey","bounds","formattedBounds","source_display","source_database","Typography","xmlns","cx","cy","join","Charts","chartData","dashExpanded","toggleDashExpanded","hiddenElements","setHiddenElements","React","useState","getLineChart","chart","ElementComponent","AreaChart","Area","LineChart","Line","formatter","getName","ResponsiveContainer","aspect","maxHeight","ComposedChart","margin","top","right","left","bottom","CartesianGrid","XAxis","YAxis","domain","undefined","tickFormatter","Tooltip","cursor","Legend","onClick","hiddenMap","cloneDeep","iconSize","iconType","hide","legendType","tooltipType","stackId","firstRow","headers","TableCell","scope","rows","TableRow","component","TableContainer","Table","textAlign","fontWeight","minWidth","TableHead","TableBody","getNested","theme","useTheme","isSm","useMediaQuery","breakpoints","down","up","el","val","MULTI_LINE_TEXT_DELIN","title","getIntro","country","find","variant","lg","maxWidth","xl","mb","sm","display","mr","md","letterSpacing","textTransform","m","flexWrap","pt","justifyContent","xs","showHide","caret","pb","pl","px","transform","transition","Button","url","Link","target","rel","href","flexBasis","flexShrink","ml","HomePage","homeCopy","tapFields","CMS_FIELDS","TAP","blurb","dangerouslySetInnerHTML","__html","transformLink","py","borderRadius","paddingInlineStart","getTapList","Dictionary","dictionary","mx","mt","palette","paper","columnCount","columnGap","sort","a","b","term","M","definition","App","setIso","setChartData","setDictionary","setCountries","setHomeCopy","setChartIds","setChartConfigsMap","setDashExpanded","useEffect","then","homecopy","charts","getChartData","loading","Paper","elevation","fontFamily","typography","realIso","createTheme","primary","main","secondary","ThemedApp","ThemeProvider","rootElement","document","getElementById","render","min","isFinite","toString","toPrecision","t","replaceAll","CONFIG_FIELDS","modelled","DATA_FIELDS","indicator","indicator_description","sex","age","population_segment","population_sub_group","country_name","area_name","geographic_scope","value_comment","unit_format","source_organization","notes","modality","modality_category","import_file","import_timestamp","row_id","suppressed","Deliverable","Supplier","quarter","SPECIAL_VALUES","link_url","GENERATED_FIELDS","DISPLAY_VALUE_LOWER","DISPLAY_VALUE_UPPER"],"mappings":"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","file":"static/js/main.b11671c1.chunk.js","sourcesContent":["import {\n  tomato,\n  red,\n  crimson,\n  pink,\n  plum,\n  purple,\n  violet,\n  indigo,\n  blue,\n  cyan,\n  teal,\n  green,\n  grass,\n  orange,\n  brown,\n  sky,\n  mint,\n  lime,\n  yellow,\n  amber,\n  gray,\n  mauve,\n  slate,\n  sage,\n  olive,\n  sand,\n  gold,\n  bronze,\n} from \"@radix-ui/colors\";\n\n// keep in sync with index.html background\nexport const themePrimary = sand;\nexport const themeSecondary = indigo;\nexport const headerColor = gold;\nexport const coreColors = [orange, grass, plum];\nexport const altColors = [tomato, indigo, gold];\nexport const alt2Colors = [sky, brown, violet, sand];\nexport const colorGroups = [coreColors, altColors, alt2Colors];\n// these intensities correspond to the radix index to use\nexport const fillIntensity = 8;\nexport const strokeIntensity = 11;\n\nexport const radColors = [\n  tomato,\n  red,\n  crimson,\n  pink,\n  plum,\n  purple,\n  violet,\n  indigo,\n  blue,\n  cyan,\n  teal,\n  green,\n  grass,\n  orange,\n  brown,\n  sky,\n  mint,\n  lime,\n  yellow,\n  amber,\n  gray,\n  mauve,\n  slate,\n  sage,\n  olive,\n  sand,\n  gold,\n  bronze,\n];\n\nexport const getRC = (radColor, idx) => {\n  // return custom colors as-is\n  if (typeof radColor === \"string\") return radColor;\n  const c1 = Object.keys(radColor)[0];\n  const c = c1.replace(/\\d/, \"\") + idx;\n  return radColor[c];\n};\n","import _ from \"lodash\";\nimport { colorGroups } from \"../consts/colors\";\nimport {\n  CONFIG_FIELDS as C,\n  DATA_FIELDS as D,\n  GENERATED_FIELDS as G,\n  SPECIAL_VALUES as S,\n} from \"../consts/data\";\nimport { capValue, displayNumber, displayPercent } from \"./display\";\n\n// functions to test whether a row matches a filter for special Sheet cell input values\nconst SPECIAL_FILTERS_MAP = {\n  _NONE_: _.negate(_.identity), // cells only included if empty\n  _SOMETHING_: _.identity, // cells only included if not empty\n  _ANY_: _.stubTrue, // allow any cell value (to overwrite broader filter)\n};\n// default function to test whether a row matches a filter\nconst defaultCompFn = (cellVal, filterVal) =>\n  cellVal.toLowerCase() === filterVal.toLowerCase();\n\n// HELPERS\nexport const getUrl = (gid) =>\n  `https://docs.google.com/spreadsheets/d/e/2PACX-1vSAEOXOt5aHDcb35lpCsSO5AvHTZPplXHrHGaIXTJjCtW_B96D0MOItWZLGv1j4lagTxnuVClms6M0X/pub?gid=${gid}&single=true&output=csv`;\n\nexport const configParser = (row) => {\n  if (!row[C.chartId]) return;\n  // if (row[C.chartId].startsWith(S._page_element_)) {}\n  delete row[\"\"];\n\n  _.each(row, (value, key) => {\n    // remove k/v pair for actually empty values\n    if (value === \"\") delete row[key];\n    // turn \"null\" in sheet into \"\" values\n    // else row[key] = value === \"null\" ? \"\" : value;\n  });\n\n  return row;\n};\n\nexport const filterByCountryGenerator = (selectedIso) => {\n  return (row) => (row[D.country_iso_code] === selectedIso ? row : null);\n};\n\n// determine actual chart elements from chart config\nexport const getElements = (chartConfig) =>\n  Object.keys(chartConfig).filter((k) => k !== S.all && !k.startsWith(S._key_));\n\n// get setting from element, else chart, else global\nexport const getSetting = ({\n  element = S.all,\n  chartConfigsMap,\n  field,\n  chartId = S.all,\n}) =>\n  _.get(chartConfigsMap, [chartId, element, 0, field]) ||\n  _.get(chartConfigsMap, [chartId, S.all, 0, field]) ||\n  _.get(chartConfigsMap, [S.all, 0, field]);\n\n// omit element to get chart-wide setting\nexport const getField = ({ element = S.all, chartConfig, field }) =>\n  _.get(chartConfig, [element, 0, field]);\n\n// omit element to get chart-wide setting\nexport const getFieldBoolean = ({ element = S.all, chartConfig, field }) =>\n  !!getField({ element, chartConfig, field });\n\nexport const getFormula = ({ element, chartConfig }) =>\n  getField({ element, chartConfig, field: C.formula });\n\nexport const getBounds = (row = {}) => {\n  const { [D.value_lower]: vLower, [D.value_upper]: vUpper } = row;\n  if (!parseFloat(vLower) || !parseFloat(vUpper)) return;\n  return [parseFloat(vLower), parseFloat(vUpper)];\n};\n\n// determine a chart's colors based on its override settings\nexport const getColors = ({\n  chartSettings,\n  chartConfig,\n  chartElements: visibleElements,\n}) => {\n  // chart-wide override determines which color group to use\n  let groupIdx = parseInt(Math.abs(_.get(chartSettings, C.colorOverride)));\n  groupIdx = ((groupIdx || 1) - 1) % colorGroups.length;\n\n  const baseColors = colorGroups[groupIdx];\n  const colors = visibleElements.map((element, idx) => {\n    // element-specific overrides trump the base group color\n    const override = getField({ chartConfig, element, field: C.colorOverride });\n    return override || baseColors[idx % baseColors.length];\n  });\n\n  const type = _.get(chartSettings, C.chartType);\n  // nested boxes charts need one more color than they have elements\n  if (type === \"nested\")\n    colors.push(baseColors[visibleElements.length % baseColors.length]);\n\n  return colors;\n};\n\n// turn \"[2018-2020]\" into [2018, 2019, 2020]\nexport const transformYearRange = (range) => {\n  const regex = /\\[(\\d+)-(\\d+)\\]/;\n  const result = regex.exec(range);\n  if (!result || !result.length > 1) return [];\n  const y1 = parseInt(result[1]);\n  const y2 = parseInt(result[2]);\n  return _.range(y1, y2 + 1).map(String);\n};\n\n// derive a row filter of type { sex: \"males\", age: \"15+\" }\nexport const getFilter = ({\n  chartId,\n  element,\n  year = null,\n  selectedIso,\n  chartConfigsMap,\n}) => {\n  // filter applied to all charts\n  const allChartsFilter = _.get(chartConfigsMap, [S.all, 0], {});\n  // filter applied to all elements within this chart\n  const allElementsFilter = _.get(chartConfigsMap, [chartId, S.all, 0], {});\n  // filter applied to this element\n  // (backupFilters may be used for source prioritization)\n  const [elementFilter, ...backupFilters] = _.get(\n    chartConfigsMap,\n    [chartId, element],\n    [{}]\n  );\n  // console.log(elementFilter);\n\n  const filter = {\n    ...allChartsFilter,\n    ...allElementsFilter,\n    ...elementFilter,\n    selectedIso,\n  };\n  if (!!year) filter.year = year;\n  return filter;\n};\n\n// find appropriate row using filter\nexport const getRow = ({ filter, chartSourceData }) => {\n  const matchingRows = _.filter(chartSourceData, (row) => {\n    return _.every(filter, (filterVal, field) => {\n      // only filter by data sheet fields\n      if (!D[field]) return true;\n\n      const cellVal = row[field] || \"\";\n      let comparisonFn = SPECIAL_FILTERS_MAP[filterVal] || defaultCompFn;\n\n      // if (!row[field]) return !filterVal;\n      return !!comparisonFn(cellVal, filterVal);\n    });\n  });\n\n  // find highest year, use source year to break ties\n  return _.maxBy(matchingRows, (r) => {\n    const y = Number(_.get(r, D.year, 0));\n    const sy = Number(_.get(r, D.sourceYear, 0));\n    return y + sy / 10000;\n  });\n};\n\n// find/create data point to use for a line point or table cell\nexport const getDataPoint = ({\n  chartId,\n  element,\n  year = null,\n  selectedIso,\n  chartConfigsMap,\n  chartSourceData,\n  // valueParser = _.identity,\n}) => {\n  const filter = getFilter({\n    chartId,\n    element,\n    year,\n    selectedIso,\n    chartConfigsMap,\n    chartSourceData,\n  });\n\n  const row = getRow({ filter, chartSourceData });\n\n  // usually we care about \"value\", but sometimes \"value_comment\"\n  const valueField = _.get(filter, C.valueField, D.value);\n  let value = _.get(row, valueField, null);\n\n  if (!row || !value) return {};\n\n  // add display name for elements appearance in legend, tooltip\n  const displayName = getField({\n    element,\n    chartConfig: chartConfigsMap[chartId],\n    field: C.displayName,\n  });\n  displayName && _.set(row, G.DISPLAY_NAME, displayName);\n\n  // assume that value_comment (or other non-value) field is for non-numeric column\n  if (valueField && valueField !== D.value) return { row, value };\n\n  // assume that value holds numeric data, proceed to process\n  return capAndFormat({ row, value, chartConfigsMap, chartId, element });\n};\n\n// mutates its row input!\n// applies caps and display formatting settings to numeric row/values\nexport const capAndFormat = ({\n  row,\n  value,\n  chartConfigsMap,\n  chartId,\n  element,\n}) => {\n  let displayValue = value;\n\n  const isPercentage = getFieldBoolean({\n    chartConfig: chartConfigsMap[chartId],\n    field: C.percentage,\n  });\n\n  if (isPercentage) {\n    const cap = getSetting({\n      chartConfigsMap,\n      chartId,\n      element,\n      field: C.capPercentage,\n    });\n    const decimals = getSetting({\n      chartConfigsMap,\n      chartId,\n      element,\n      field: C.percentageDecimals,\n    });\n\n    // value = value && valueParser(value);\n    const options = { cap, decimals };\n    // be sure to capture display value BEFORE capping, so it includes >\n    displayValue = displayPercent(value, options);\n    value = capValue(value, options);\n    // overwriting\n    capValue && _.set(row, D.value, value);\n\n    [D.value_lower, D.value_upper].forEach((F) => {\n      const v = _.get(row, F);\n\n      // formatted capped val for tooltips\n      v && _.set(row, `DISPLAY_${F.toUpperCase()}`, displayPercent(v, options));\n\n      // capped val for plotting\n      const cv = v && capValue(v, options);\n      cv && _.set(row, F, cv);\n    });\n  } else {\n    // is integer\n    const coarseFormatting = !!getSetting({\n      chartConfigsMap,\n      chartId,\n      element,\n      field: C.coarseIntegerFormatting,\n    });\n    displayValue = displayNumber(value, { coarseFormatting });\n\n    [D.value_lower, D.value_upper].forEach((F) => {\n      let v = _.get(row, F);\n      // formatted value for tooltips\n      v && _.set(row, `DISPLAY_${F.toUpperCase()}`, displayNumber(v));\n      // v && _.set(row, F, v);\n    });\n  }\n\n  // formatted value for tooltips\n  displayValue && _.set(row, G.DISPLAY_VALUE, displayValue);\n\n  return { row, value };\n};\n\n// create derived data point (from other found points) using formula provided in Sheet\nexport const getCalculatedDataPoint = ({\n  chartConfigsMap,\n  element,\n  dataPoints,\n  chartId,\n}) => {\n  const chartConfig = chartConfigsMap[chartId];\n  const rawFormula = getFormula({ element, chartConfig });\n  let convertedFormula = rawFormula;\n\n  // where the *magic* happens: formula is converted from the\n  // string provided in the Sheet to an actual mathematical\n  // expression by swapping element names for their values\n  // e.g.:  total_hiv-aware  becomes  7843-384\n  _.each(dataPoints, (value, key) => {\n    convertedFormula = convertedFormula.replace(key, value);\n  });\n\n  let result = null;\n  // attempt to evaluate the resulting expression\n  try {\n    result = eval(convertedFormula);\n  } catch (error) {\n    console.warn(`cannot evaluate ${rawFormula} (${convertedFormula})`);\n    return { value: null };\n  }\n\n  // only allow numbers & arith operators (otherwise eg null will evaluate to 0)\n  if (!/^[\\d-+*\\/\\.]+$/.test(convertedFormula) || !_.isNumber(result)) {\n    console.warn(`missing values for ${rawFormula} (${convertedFormula})`);\n    return { value: null };\n  }\n\n  // add display name for elements appearance in legend, tooltip\n  const displayName =\n    getField({\n      element,\n      chartConfig,\n      field: C.displayName,\n    }) || element;\n\n  // console.log(result);\n  return capAndFormat({\n    value: result,\n    row: { [G.DISPLAY_NAME]: displayName },\n    chartConfigsMap,\n    chartId,\n    element,\n  });\n};\n","import { csv } from \"d3-fetch\";\nimport _ from \"lodash\";\nimport {\n  CONFIG_FIELDS as C,\n  DATA_FIELDS as D,\n  // GENERATED_FIELDS as G,\n  SPECIAL_VALUES as S,\n  GID_MAP,\n  CONFIGURABLE_GID_NAMES,\n  TABLE_DELIN,\n  PRE_LOAD_DATA,\n  CMS_SHEETS,\n} from \"./consts/data\";\nimport {\n  getUrl,\n  configParser,\n  filterByCountryGenerator,\n  getElements,\n  getFieldBoolean,\n  getFormula,\n  getBounds,\n  getColors,\n  transformYearRange,\n  getDataPoint,\n  getCalculatedDataPoint,\n  getField,\n  getSetting,\n} from \"./utils/data\";\n\n// ASYNC FETCHERS\nasync function setConfigGids() {\n  // return if already configured\n  if (CONFIGURABLE_GID_NAMES.every((name) => !!GID_MAP[name])) return;\n  const homeRows = await csv(getUrl(GID_MAP.home)).catch((e) => {\n    console.error(\"error in csv(getUrl(GID_MAP.home)): \", e);\n  });\n  CONFIGURABLE_GID_NAMES.forEach((name) => {\n    const lastConfiguredRow = _.findLast(homeRows, (r) => !!r[name]);\n    if (!lastConfiguredRow) {\n      console.error(\"No Sheet GID found for: \", name);\n      return;\n    }\n    GID_MAP[name] = lastConfiguredRow[name];\n  });\n}\n\nasync function getChartConfigs() {\n  const baseConfigs = await csv(getUrl(GID_MAP.configs), configParser).catch(\n    (e) => {\n      console.error(\"error in csv(getUrl(GID_MAP.configs), configParser): \", e);\n    }\n  );\n  const shaped = _.groupBy(baseConfigs, C.chartId);\n\n  const chartIds = _.uniqBy(baseConfigs, \"chart_id\")\n    .map((c) => c.chart_id)\n    .filter((id) => id !== S.all);\n\n  const chartConfigsMap = _.mapValues(shaped, (configParams, name) => {\n    // wise?\n    if (name === S.all) return configParams;\n    return _.groupBy(configParams, C.element);\n  });\n\n  _.each(chartConfigsMap, (configParams, name) => {\n    if (name === S.all) return;\n    _.each(configParams, (elemDetails, elementName) => {\n      if (elementName === S.all) return;\n    });\n  });\n\n  return { chartConfigsMap, chartIds };\n}\n\nasync function getAllDataFromTab(gid) {\n  // console.log(\"get data from\", gid);\n  if (!gid) return null;\n  return await csv(getUrl(gid)).catch((e) => {\n    console.error(\"error in getChartOrTable()): \", e);\n  });\n}\n\n// so we only request data from each tab once\n// after first dashboard load, countries should load instantly\nconst memoizedGetAllDataFromTab = _.memoize(getAllDataFromTab);\n\nasync function getCountryDataFromTab(gid, selectedIso) {\n  const allData = await memoizedGetAllDataFromTab(gid);\n\n  return allData.filter((d) => filterByCountryGenerator(selectedIso)(d));\n}\n\nasync function getCharts({ chartConfigsMap, chartIds, selectedIso }) {\n  return await Promise.all(\n    chartIds.map((chartId) =>\n      chartId.startsWith(S._page_element_)\n        ? getPageElement({ chartConfigsMap, chartId, selectedIso })\n        : getChartOrTable({ chartConfigsMap, chartId, selectedIso })\n    )\n  ).catch((e) => {\n    console.error(\"error in getCharts(): \", e);\n  });\n}\n\nasync function getPageElement({ chartConfigsMap, chartId }) {\n  const elementConfig = chartConfigsMap[chartId];\n  const elementSettings = _.get(elementConfig, [S.all, 0]);\n  const text = _.get(elementSettings, C.displayName);\n\n  const elementId = chartId.replace(S._page_element_, \"\");\n  const type = elementId.startsWith(\"link\")\n    ? \"link\"\n    : elementId.startsWith(\"accordion\")\n    ? \"accordion\"\n    : null;\n\n  return {\n    elementId,\n    text,\n    type,\n  };\n}\n\nasync function getChartOrTable({ chartConfigsMap, chartId, selectedIso }) {\n  if (\n    [\n      // \"deliverables\",\n      // \"interventions\",\n      // \"priorities\",\n      // \"policy\",\n      // \"commun_deliv\",\n      // \"late_hiv\"\n    ].includes(chartId)\n  )\n    return;\n  // console.log(\"creating : \", chartId);\n  const chartConfig = chartConfigsMap[chartId];\n  // the chart settings are the values on the chart config where element === S.all (\"all\")\n  const chartSettings = _.get(chartConfig, [S.all, 0]);\n\n  if (!chartConfig || !chartSettings || !chartSettings[C.sourceGid]) {\n    console.warn(\"skipping chart: \", chartId);\n    return null;\n  }\n  const chartSourceData = await getCountryDataFromTab(\n    chartSettings[C.sourceGid],\n    selectedIso\n  );\n\n  const getterMap = {\n    table: getTable,\n    table_list: getTableList,\n    text: getText,\n    // nested: getNested, // uses chart\n  };\n\n  const getter = _.get(getterMap, chartSettings[C.chartType], getChart);\n\n  return getter({\n    chartId,\n    chartSettings,\n    chartConfigsMap,\n    chartSourceData,\n    selectedIso,\n  });\n}\n\nfunction getText({\n  chartId,\n  chartSettings,\n  chartConfigsMap,\n  chartSourceData,\n  selectedIso,\n}) {\n  // console.log(\n  //   chartId,\n  //   chartSettings,\n  //   chartConfigsMap,\n  //   chartSourceData,\n  //   selectedIso\n  // );\n\n  const elements = getElements(chartConfigsMap[chartId]);\n  const textValues = {};\n  _.each(elements, (element) => {\n    const { row, value } = getDataPoint({\n      chartId,\n      element,\n      selectedIso,\n      chartConfigsMap,\n      chartSourceData,\n      // valueParser: isPercentage\n    });\n    textValues[element] = value;\n    textValues[`${element}_row`] = row;\n  });\n\n  return {\n    textValues,\n    chartId,\n    countryIso: selectedIso,\n    elements,\n    type: _.get(chartSettings, C.chartType),\n    name: _.get(chartSettings, C.displayName, chartId),\n    hiddenUntilExpand: _.get(chartSettings, C.hiddenUntilExpand),\n  };\n}\n\nfunction getTableList({\n  chartId,\n  chartSettings,\n  chartConfigsMap,\n  chartSourceData,\n  selectedIso,\n}) {\n  const chartConfig = chartConfigsMap[chartId];\n  const chartWideConfig = _.get(chartConfig, [S.all, 0]);\n  const colNames = Object.keys(chartWideConfig).filter(\n    (f) => !!D[f] || _.some(D.REGEX, (rgx) => !!rgx.test(f))\n  );\n\n  /*\n   * Get colorBy background color\n   * eg \"Q3 2021\" data field has value \"_color_by_status\"\n   * for Deliverables table. It also has a \"key\" element of\n   * _key__color_by_status__completed with corresponding\n   * display_name of green. Here we create a map of:\n   * { status: { completed: green, ... }} to later identify\n   * \"completed\" cells to give a background color \"green\".\n   */\n  let colorMap = {};\n  try {\n    colorMap = Object.keys(chartConfig)\n      .filter((key) => key.startsWith(`${S._key_}${S._color_by_}`))\n      .reduce((accum, key) => {\n        const KVPairToBeColored = key.replace(`${S._key_}${S._color_by_}`, \"\");\n        const [k, v] = KVPairToBeColored.split(\"__\");\n        const color = _.get(chartConfig, [key, 0, C.displayName]);\n        if (color) _.set(accum, [k, v], color);\n        return accum;\n      }, {});\n  } catch (error) {\n    console.warn(\n      `color mapping entered incorrectly for ${chartId}, ignoring. ${error}`\n    );\n  }\n\n  const data = chartSourceData.map((row, i) => {\n    return {\n      rowName: i,\n      values: colNames.map((cn) => {\n        const value = _.get(row, cn);\n        const LCVal = value && value.toLowerCase();\n\n        let chartWideFieldVal = _.get(chartWideConfig, cn, \"\");\n        chartWideFieldVal =\n          chartWideFieldVal.includes(S._color_by_) &&\n          chartWideFieldVal.replace(S._color_by_, \"\");\n        // use the above described map to _.get, eg, [\"status\", \"complete\"]\n        const chartColorSetting = _.get(colorMap, [chartWideFieldVal, LCVal]);\n\n        return {\n          columnName: cn,\n          columnNamed: true, // always named with the field name\n          value,\n          color: chartColorSetting,\n          sheetRow: row,\n        };\n      }),\n    };\n  });\n\n  const chart = {\n    data,\n    chartId,\n    countryIso: selectedIso,\n    hideRowNames: true,\n    // elements: elements,\n    // isPercentage,\n    type: _.get(chartSettings, C.chartType),\n    name: _.get(chartSettings, C.displayName, chartId),\n    hiddenUntilExpand: _.get(chartSettings, C.hiddenUntilExpand),\n  };\n\n  return chart;\n}\n\nfunction getTable({\n  chartId,\n  chartSettings,\n  chartConfigsMap,\n  chartSourceData,\n  selectedIso,\n}) {\n  const chartConfig = chartConfigsMap[chartId];\n\n  const elements = getElements(chartConfig);\n  const dataPoints = {};\n\n  const isPercentage = getFieldBoolean({\n    chartConfig,\n    field: C.percentage,\n  });\n  _.each(elements, (element) => {\n    const { row, value } = getDataPoint({\n      chartId,\n      element,\n      selectedIso,\n      chartConfigsMap,\n      chartSourceData,\n      // valueParser: isPercentage\n    });\n    dataPoints[element] = value;\n    dataPoints[element + \"_row\"] = row;\n  });\n\n  const rowNames = _.uniq(elements.map((elem) => elem.split(TABLE_DELIN)[0]));\n  const colNames = _.uniq(elements.map((elem) => elem.split(TABLE_DELIN)[1]));\n\n  const data = rowNames.map((rn) => ({\n    rowName: _.get(chartConfig, [`${S._key_}${rn}`, 0, C.displayName], rn),\n    values: colNames.map((cn) => ({\n      columnName: _.get(chartConfig, [`${S._key_}${cn}`, 0, C.displayName], cn),\n      columnNamed: _.get(\n        chartConfig,\n        [`${S._key_}${cn}`, 0, C.displayName],\n        false\n      ),\n      value: _.get(dataPoints, `${rn}${TABLE_DELIN}${cn}`),\n      sheetRow: _.get(dataPoints, `${rn}${TABLE_DELIN}${cn}_row`),\n    })),\n  }));\n\n  const chart = {\n    data,\n    chartId,\n    countryIso: selectedIso,\n    elements: elements,\n    isPercentage,\n    type: _.get(chartSettings, C.chartType),\n    name: _.get(chartSettings, C.displayName, chartId),\n    hiddenUntilExpand: _.get(chartSettings, C.hiddenUntilExpand),\n  };\n\n  return chart;\n}\n\nfunction getChart({\n  chartId,\n  chartSettings,\n  chartConfigsMap,\n  chartSourceData,\n  selectedIso,\n}) {\n  const chartConfig = chartConfigsMap[chartId];\n\n  const elements = getElements(chartConfig);\n  const visibleElements = elements.filter(\n    (element) => !getFieldBoolean({ element, chartConfig, field: C.hidden })\n  );\n  // console.log(elements);\n\n  // NOTE: currently all charts range over years\n  const year_range = _.get(chartConfig, [S.all, 0, D.year]);\n  const isTimeseries = year_range;\n  const years_arr = isTimeseries ? transformYearRange(year_range) : [S.all];\n  // console.log(years_arr);\n\n  // getchartdata per element\n  const data = _.map(years_arr, (year) => {\n    const dataPoints = {};\n\n    // add non-calculated points\n    _.each(elements, (element) => {\n      if (!!getFormula({ element, chartConfig })) return null;\n      const { row, value } = getDataPoint({\n        chartId,\n        element,\n        year: isTimeseries ? year : null,\n        selectedIso,\n        chartConfigsMap,\n        chartSourceData,\n      });\n      dataPoints[element] = value;\n      dataPoints[element + \"_row\"] = row;\n      dataPoints[element + \"_bounds\"] = getBounds(row);\n    });\n\n    // add calculated points (now that non-calculated constituents have values)\n    _.each(elements, (element) => {\n      if (!getFormula({ element, chartConfig })) return null;\n      const { row, value } = getCalculatedDataPoint({\n        chartId,\n        element,\n        chartConfigsMap,\n        dataPoints,\n      });\n      dataPoints[element] = value;\n      dataPoints[element + \"_row\"] = row;\n    });\n\n    // delete elements used only as constituents in calculations\n    _.each(elements, (element) => {\n      if (getFieldBoolean({ element, chartConfig, field: C.hidden })) {\n        // console.log(\"deleting: \", element);\n        delete dataPoints[element];\n      }\n    });\n    dataPoints.name = year;\n    // console.log(dataPoints);\n    return dataPoints;\n  });\n\n  const elementNameMap = {};\n  _.each(\n    visibleElements,\n    (element) =>\n      (elementNameMap[element] = getField({\n        element,\n        chartConfig: chartConfigsMap[chartId],\n        field: C.displayName,\n      }))\n  );\n\n  const colors = getColors({\n    chartSettings,\n    chartConfig,\n    chartElements: visibleElements,\n  });\n\n  const chart = {\n    data: isTimeseries ? data : data[0],\n    chartId,\n    countryIso: selectedIso,\n    elements: visibleElements,\n    elementNameMap,\n    colors,\n    isPercentage: getFieldBoolean({\n      chartConfig,\n      field: C.percentage,\n    }),\n    type: _.get(chartSettings, C.chartType),\n    name: _.get(chartSettings, C.displayName, chartId),\n    hiddenUntilExpand: _.get(chartSettings, C.hiddenUntilExpand),\n  };\n\n  return chart;\n}\n// ___ END ASYNC FETCHERS _____\n\n// MAIN FUNCTIONS\n\n/** SITE DATA - runs once on site load */\nexport async function getSiteData() {\n  // if (DISABLED) return [];\n  // CONFIGURE GIDS MAP\n  await setConfigGids().catch((e) => {\n    console.error(\"error in setConfigGids(): \", e);\n  });\n\n  // GRAB STRAIGHT-FORWARD TEXT COPY\n  const cmsDataResults = await Promise.all(\n    CMS_SHEETS.map((sheetName) =>\n      csv(getUrl(GID_MAP[sheetName])).catch((e) =>\n        console.error(`error getting ${sheetName}: `, e)\n      )\n    )\n  );\n  const cmsData = cmsDataResults.reduce((accum, result, idx) => {\n    const sheetName = CMS_SHEETS[idx];\n    accum[sheetName] = result;\n\n    return accum;\n  }, {});\n\n  // const countries = await csv(getUrl(GID_MAP.countries)).catch((e) =>\n  //   console.error(\"error in getcountries: \", e)\n  // );\n\n  // GRAB CONFIGS\n  const { chartConfigsMap, chartIds } = await getChartConfigs().catch((e) =>\n    console.error(\"error in getChartConfigs(): \", e)\n  );\n  console.log(\"@@@ ALL CONFIGS: \");\n  console.log(chartConfigsMap);\n\n  // request all data tabs' data for speedy loading on country selection\n  if (PRE_LOAD_DATA) {\n    const gids = _.map(chartConfigsMap, (config, chartId) =>\n      getSetting({ chartConfigsMap, chartId, field: C.sourceGid })\n    );\n    // console.log(\"gids: \", gids);\n    gids.forEach(memoizedGetAllDataFromTab);\n  }\n\n  return { ...cmsData, chartConfigsMap, chartIds };\n}\n\n/** CREATE CHARTS - whenever selected country changes */\nexport async function getChartData({ chartConfigsMap, chartIds, selectedIso }) {\n  const charts = await getCharts({\n    chartConfigsMap,\n    chartIds,\n    selectedIso\n  }).catch((e) => {\n    console.error(\"error in getCharts(selectedIso): \", e);\n  });\n\n  return { charts };\n}\n","import React from \"react\";\nimport { FormControl, InputLabel, MenuItem, Select } from \"@mui/material\";\n\nexport const CountrySelect = ({\n  handleCountryChange,\n  selectedIso,\n  countries,\n}) => {\n  return (\n    <FormControl sx={{ width: 300, marginTop: 1, marginBottom: 1 }}>\n      <InputLabel id=\"country\">Country</InputLabel>\n      <Select\n        labelId=\"country\"\n        id=\"country-select\"\n        value={selectedIso || \"home\"}\n        label=\"Country\"\n        onChange={handleCountryChange}\n      >\n        <MenuItem value={\"home\"}>\n          {!countries.length ? \"Loading...\" : \"Select a country...\"}\n        </MenuItem>\n        {countries.map(({ iso, name }) => (\n          <MenuItem key={iso} value={iso}>\n            {name}\n          </MenuItem>\n        ))}\n      </Select>\n    </FormControl>\n  );\n};\n","import React from \"react\";\nimport AppBar from \"@mui/material/AppBar\";\nimport Box from \"@mui/material/Box\";\nimport Toolbar from \"@mui/material/Toolbar\";\nimport { CountrySelect } from \"./CountrySelect\";\nimport { getRC, headerColor } from \"../consts/colors\";\n\nexport const Header = ({ selectedIso, handleCountryChange, countries }) => {\n  return (\n    <Box sx={{ flexGrow: 1 }}>\n      <AppBar position=\"fixed\" sx={{ background: getRC(headerColor, 7) }}>\n        <Toolbar>\n          <CountrySelect\n            countries={countries}\n            handleCountryChange={handleCountryChange}\n            selectedIso={selectedIso}\n          />\n        </Toolbar>\n      </AppBar>\n    </Box>\n  );\n};\n","import React from \"react\";\n// import './styles.css'\nimport _ from \"lodash\";\n\nconst BUFFER_RATIO = 0.2;\nconst TEXT_BUFFER_RATIO = 0.1;\nconst DEFAULT_RATIO = 0.7;\nconst FONT_SIZE_RATIO = 0.1;\nconst HEADER_FONT_SIZE_RATIO = 0.16;\nconst LINE_HEIGHT = 1.1;\nconst CAP_VALUE = null;\n\nconst innerTextGetter = (ratio, { capValue }) => {\n  return !ratio\n    ? \"Unknown %\"\n    : capValue && ratio > capValue\n    ? `>${capValue * 100}%`\n    : `${Math.round(ratio * 100)}%`;\n};\n\nconst NestedBoxes = ({\n  ratios,\n  fillColors,\n  textColors,\n  content,\n  firstSide = 100,\n  horizontal = true,\n  classes = \"\",\n  getInnerText = innerTextGetter,\n  bufferRatio = BUFFER_RATIO,\n  textBufferRatio = TEXT_BUFFER_RATIO,\n  defaultRatio = DEFAULT_RATIO,\n  capValue = CAP_VALUE,\n  fontSizeRatio = FONT_SIZE_RATIO,\n  headerFontSizeRatio = HEADER_FONT_SIZE_RATIO,\n  lineHeight = LINE_HEIGHT,\n}) => {\n  const resolveOrientation = (v1, v2) => {\n    return horizontal ? v2 : v1;\n  };\n\n  const bufferDistance = firstSide * (1 + bufferRatio);\n  const textBufferDistance = firstSide * (1 + textBufferRatio);\n\n  let side = firstSide;\n  let x = 0;\n  let y = 0;\n\n  const fontSize = firstSide * fontSizeRatio;\n  const headerFontSize = firstSide * headerFontSizeRatio;\n\n  const rects = [];\n  const texts = [];\n  const connectingLines = [];\n\n  _.each(ratios, (ratio, i) => {\n    // const noRatio = !ratio\n    const innerText = getInnerText(ratio, { capValue });\n    ratio = ratio || defaultRatio;\n\n    if (capValue && ratio > capValue) {\n      ratio = capValue;\n    }\n\n    const colorOuter = fillColors[i];\n    const colorInner = fillColors[i + 1];\n    const textColor = textColors[i + 1];\n\n    // add outer box\n    rects.push(\n      <rect\n        key={\"rect1-\" + i}\n        x={resolveOrientation(x, y)}\n        y={resolveOrientation(y, x)}\n        width={side}\n        height={side}\n        fill={colorOuter}\n      />\n    );\n\n    const { below = [] } = _.get(content, i, {});\n    const text = (\n      <text\n        key={\"text-\" + i}\n        fontSize={fontSize}\n        // set the initial y for all tspans\n        // the x we set on each individually so they don't try to go one after another\n        y={resolveOrientation(y + fontSize, textBufferDistance + fontSize)}\n      >\n        <tspan\n          className=\"percent\"\n          x={resolveOrientation(textBufferDistance, y)}\n          style={{ fill: textColor, fontSize: headerFontSize }}\n        >\n          {innerText}\n        </tspan>\n        {below.map((txt, j) => (\n          <tspan\n            key={i + j}\n            className=\"description\"\n            x={resolveOrientation(textBufferDistance, y)}\n            dy={fontSize * lineHeight}\n          >\n            {txt}\n          </tspan>\n        ))}\n      </text>\n    );\n    texts.push(text);\n\n    let nextSide = side * ratio;\n    const borderWidth = (side - nextSide) / 2; // the amount of outer box that shows around the inner box\n    x += borderWidth;\n    y += borderWidth;\n    side = nextSide;\n\n    // add inner box\n    rects.push(\n      <rect\n        key={\"rect2-\" + i}\n        x={resolveOrientation(x, y)}\n        y={resolveOrientation(y, x)}\n        width={side}\n        height={side}\n        fill={colorInner}\n      />\n    );\n\n    if (i === ratios.length - 1) {\n      return;\n    }\n\n    const lineStyle = {\n      strokeWidth: \".4\",\n      strokeDasharray: \".8 1\",\n    };\n    // if there's another box coming, add lines to it\n    const line1 = (\n      <line\n        key={\"line1-\" + i}\n        style={lineStyle}\n        stroke={colorInner}\n        x1={resolveOrientation(x, y + side)}\n        x2={resolveOrientation(x, y + bufferDistance)}\n        y1={resolveOrientation(y + side, x)}\n        y2={resolveOrientation(y + bufferDistance, x)}\n      />\n    );\n    const line2 = (\n      <line\n        key={\"line2-\" + i}\n        style={lineStyle}\n        stroke={colorInner}\n        x1={resolveOrientation(x + side, y + side)}\n        x2={resolveOrientation(x + side, y + bufferDistance)}\n        y1={resolveOrientation(y + side, x + side)}\n        y2={resolveOrientation(y + bufferDistance, x + side)}\n      />\n    );\n    connectingLines.push(line1, line2);\n\n    // and shift down for the next\n    y += bufferDistance;\n  });\n\n  const totalX = firstSide + (textBufferDistance + firstSide); // (text width)\n  const totalY = y + firstSide;\n  const totalXh = y + bufferDistance;\n  const totalYh = textBufferDistance + (headerFontSize + fontSize * 5); // (text height)\n\n  const classNames = \"nested-boxes \" + classes;\n\n  return (\n    <div className={classNames}>\n      {/* <p className='title'>{title}</p> */}\n      <svg\n        viewBox={`0 -2 ${resolveOrientation(\n          totalX,\n          totalXh\n        )} ${resolveOrientation(totalY, totalYh)}`}\n      >\n        {rects}\n        {texts}\n        {connectingLines}\n      </svg>\n    </div>\n  );\n};\n\nexport default NestedBoxes;\n","import React from \"react\";\nimport _ from \"lodash\";\nimport Typography from \"@mui/material/Typography\";\nimport {\n  AreaChart,\n  Area,\n  ComposedChart,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  LineChart,\n  Line,\n  ResponsiveContainer,\n  Legend,\n} from \"recharts\";\nimport { Box, useTheme } from \"@mui/system\";\nimport NestedBoxes from \"./NestedBoxes\";\nimport {\n  getRC,\n  strokeIntensity,\n  fillIntensity,\n  themePrimary,\n  themeSecondary,\n} from \"../consts/colors\";\nimport { displayNumber, displayPercent } from \"../utils/display\";\nimport {\n  CONFIG_FIELDS as C,\n  DATA_FIELDS as D,\n  GENERATED_FIELDS as G,\n  MULTI_LINE_TEXT_DELIN,\n} from \"../consts/data\";\nimport {\n  Button,\n  Link,\n  Table,\n  TableBody,\n  TableCell,\n  TableContainer,\n  TableHead,\n  TableRow,\n  useMediaQuery,\n} from \"@mui/material\";\n\n// TODO: standardize / create sane system for styles\n// TODO: CLEAN / EXTRACt this and other components\nconst CustomTooltip = ({ active, payload, label, isArea }) => {\n  if (active && payload && payload.length) {\n    // if lines, stack legend to match line height order\n    const payloads = isArea ? payload : _.sortBy(payload, \"value\");\n\n    let source = null;\n    return (\n      <Box sx={{ background: \"white\", p: 2 }} className=\"custom-tooltip\">\n        <strong className=\"label\">{label}</strong>\n        {payloads.reverse().map((p) => {\n          if (p.dataKey.includes(\"_bounds\")) return;\n\n          const bounds = _.get(p.payload, p.dataKey + \"_bounds\", []);\n          const formattedBounds = [D.value_lower, D.value_upper].map((F, i) =>\n            _.get(\n              p.payload,\n              [p.dataKey + \"_row\", `DISPLAY_${F.toUpperCase()}`],\n              bounds[i]\n            )\n          );\n\n          const v = _.get(\n            p.payload,\n            [p.dataKey + \"_row\", G.DISPLAY_VALUE],\n            p.value\n          );\n          // console.log(\"$$$\", v, p.payload);\n\n          // use first source\n          source =\n            source ||\n            _.get(p.payload, [p.dataKey + \"_row\", D.source_display]) ||\n            _.get(p.payload, [p.dataKey + \"_row\", D.source_database]);\n\n          return (\n            <Typography key={p.dataKey}>\n              <svg\n                width=\"18\"\n                viewBox=\"0 0 160 100\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <circle cx=\"50\" cy=\"50\" r=\"50\" fill={p.fill}></circle>\n              </svg>\n              {p.name}: {v}{\" \"}\n              {!!bounds.length && `(${formattedBounds.join(\" - \")})`}\n            </Typography>\n          );\n        })}\n        {source && (\n          <>\n            <br />\n            <u>Source</u>: {source}\n          </>\n        )}\n      </Box>\n    );\n  } else return null;\n};\n\nexport const Charts = ({\n  selectedIso,\n  chartData,\n  countries,\n  dashExpanded,\n  toggleDashExpanded,\n}) => {\n  const [hiddenElements, setHiddenElements] = React.useState({});\n\n  const getLineChart = (chart) => {\n    const {\n      data,\n      chartId,\n      elements,\n      type,\n      isPercentage,\n      colors,\n      elementNameMap,\n    } = chart;\n    const isArea = type === \"area\";\n    const [, ElementComponent] = isArea ? [AreaChart, Area] : [LineChart, Line];\n\n    const formatter = isPercentage\n      ? (v) => displayPercent(v)\n      : (v) => displayNumber(v);\n\n    const getName = (elem) => _.get(elementNameMap, elem, elem);\n\n    const onLegendClick = (e) => {\n      console.log(e.dataKey);\n      const hiddenMap = _.cloneDeep(hiddenElements);\n      const hidden = _.get(hiddenMap, [chartId, e.dataKey], false);\n      _.set(hiddenMap, [chartId, e.dataKey], !hidden);\n      setHiddenElements(hiddenMap);\n    };\n\n    return (\n      <ResponsiveContainer\n        // needed for proper resizing https://github.com/recharts/recharts/issues/172#issuecomment-307858843\n        width=\"99%\"\n        aspect={1.25}\n        // height={400}\n        maxHeight={400}\n        // maxWidth={600}\n      >\n        <ComposedChart\n          // width={500}\n          // height={400}\n          data={data}\n          margin={{\n            top: 30,\n            right: 30,\n            left: 0,\n            bottom: 0,\n          }}\n        >\n          <CartesianGrid strokeDasharray=\"3 3\" />\n          <XAxis dataKey=\"name\" />\n          <YAxis\n            width={80}\n            domain={isPercentage ? [0, 100] : undefined}\n            tickFormatter={formatter}\n          />\n          <Tooltip\n            cursor={{ stroke: getRC(themeSecondary, 10), strokeWidth: 1 }}\n            content={<CustomTooltip isArea={isArea} />}\n          />\n          <Legend\n            onClick={onLegendClick}\n            iconSize={isArea ? 8 : 14}\n            iconType={isArea && \"circle\"}\n          />\n          {elements.map((elem, i) => {\n            const isBounded =\n              !isArea &&\n              _.some(data, (d) => _.get(d, [elem + \"_bounds\"], []).length);\n            if (!isBounded) return null;\n            return (\n              <Area\n                key={i + \"_b\"}\n                // type=\"step\"\n                dataKey={elem + \"_bounds\"}\n                hide={_.get(hiddenElements, [chartId, elem], false)}\n                // stackId={i + 1}\n                legendType=\"none\"\n                tooltipType=\"none\"\n                stroke={getRC(colors[i], strokeIntensity - 3)}\n                fill={getRC(colors[i], fillIntensity - 3)}\n              />\n            );\n          })}\n          {elements.map((elem, i) => (\n            <ElementComponent\n              key={i}\n              // type=\"monotone\"\n              // dataBounds={_.get(elem, [elem + \"_bounds\"], [])}\n              dataKey={elem}\n              name={getName(elem)}\n              hide={_.get(hiddenElements, [chartId, elem], false)}\n              stackId={isArea ? 1 : i + 1000}\n              stroke={getRC(colors[i], strokeIntensity)}\n              fill={getRC(colors[i], fillIntensity)}\n            />\n          ))}\n        </ComposedChart>\n      </ResponsiveContainer>\n    );\n  };\n\n  const getTable = (chart) => {\n    const { data, hideRowNames } = chart;\n\n    const firstRow = data[0];\n\n    // TODO: empty row? skip title?\n    if (!firstRow) return null;\n    // const columnsNamed = _.some(data[0][\"values\"], \"columnNamed\");\n    const headers =\n      // columnsNamed &&\n      firstRow[\"values\"].map(({ columnName, columnNamed }) => (\n        <TableCell scope=\"col\" key={columnName}>\n          {columnNamed && columnName}\n        </TableCell>\n      ));\n\n    const rows = data.map(({ rowName, values }) => (\n      <TableRow key={rowName}>\n        {!hideRowNames && (\n          <TableCell scope=\"row\" component=\"th\">\n            {rowName}\n          </TableCell>\n        )}\n        {values.map(({ value, columnName, sheetRow, color }) => (\n          <TableCell\n            key={columnName}\n            sx={{\n              background: color,\n            }}\n          >\n            {/*  */}\n            {/* {_.get(sheetRow, G.DISPLAY_VALUE, value) || \"N/A\"} (move to getData?) */}\n            {/* to not overwrite \"\" with \"N/A\":  */}\n            {_.get(sheetRow, G.DISPLAY_VALUE, _.get([value], 0, \"N/A\"))}\n            {/* {(value && (sheetRow && sheetRow[G.DISPLAY_VALUE] || value)) || \"N/A\"} */}\n          </TableCell>\n        ))}\n      </TableRow>\n    ));\n\n    return (\n      <ResponsiveContainer>\n        <TableContainer>\n          <Table\n            sx={{\n              \"& tbody tr:nth-of-type(odd)\": {\n                background: getRC(themePrimary, 6),\n              },\n              \"& td, & thead th\": {\n                textAlign: \"right\",\n              },\n              \"& th\": {\n                fontWeight: \"bold\",\n                minWidth: \"60px\",\n              },\n            }}\n          >\n            <TableHead>\n              <TableRow>\n                {!hideRowNames && <TableCell scope=\"col\"></TableCell>}\n                {headers}\n              </TableRow>\n            </TableHead>\n            <TableBody>{rows}</TableBody>\n          </Table>\n        </TableContainer>\n      </ResponsiveContainer>\n    );\n  };\n\n  const getNested = (chart) => {\n    const theme = useTheme();\n    const isSm = useMediaQuery(theme.breakpoints.down(\"sm\"));\n    const isXl = useMediaQuery(theme.breakpoints.up(\"md\"));\n    const { data, elements, colors, elementNameMap } = chart;\n    const xl = false;\n    // console.log(radColors);\n    const ratios = elements.map((el) => {\n      const val = data[el];\n      return val && val / 100;\n    });\n    const content = elements.map((el) => {\n      const text = elementNameMap[el];\n      return { below: text.split(MULTI_LINE_TEXT_DELIN) };\n    });\n    // console.log(ratios);\n    return (\n      <>\n        <NestedBoxes\n          // circle={true}\n          // classes={xl ? \"xl\" : \"\"}\n          title={\"title\"}\n          bufferRatio={!isSm ? 0.8 : 0.2}\n          lineHeight={!isSm ? 1.4 : 1.1}\n          textBufferRatio={0.2}\n          firstSide={20}\n          horizontal={!isSm}\n          ratios={ratios}\n          fillColors={colors.map((c) => getRC(c, 8))}\n          textColors={colors.map((c) => getRC(c, 9))}\n          content={content}\n        />\n        <br />\n      </>\n    );\n  };\n\n  const getIntro = (chart) => {\n    const country = countries.find((c) => c.iso === selectedIso);\n    return (\n      <>\n        <Typography\n          variant=\"h2\"\n          component=\"h1\"\n          sx={{\n            fontWeight: 500,\n            lineHeight: 1,\n            fontSize: { lg: \"6rem\" },\n            maxWidth: { lg: 760, xl: \"100%\" },\n            mb: { sm: 1, lg: 2 },\n          }}\n        >\n          {country && country.name}\n        </Typography>\n        <Box\n          sx={{\n            display: { sm: \"flex\" },\n            \"& dl:not(:last-child)\": { mr: { sm: 4, md: 10 } },\n            \"& dt h2\": {\n              fontWeight: 100,\n              letterSpacing: \".8px\",\n              textTransform: \"uppercase\",\n            },\n            \"& dt, dd\": { m: 0 },\n          }}\n        >\n          {chart.elements.map((elem) => {\n            return (\n              <dl key={elem}>\n                <dt>\n                  <Typography variant=\"h6\" component=\"h2\">\n                    {_.get(\n                      chart,\n                      [\"textValues\", `${elem}_row`, G.DISPLAY_NAME],\n                      \"\"\n                    )}\n                  </Typography>\n                </dt>\n                <dd>\n                  <Typography variant=\"h4\" component=\"h2\">\n                    {_.get(\n                      chart,\n                      [\"textValues\", `${elem}_row`, G.DISPLAY_VALUE],\n                      chart.textValues[elem]\n                    )}\n                  </Typography>\n                </dd>\n              </dl>\n            );\n          })}\n        </Box>\n      </>\n    );\n  };\n\n  const getChart = (chart) => {\n    // TODO: simplify\n    if (!chart) return null;\n\n    const { type, chartId, name, hiddenUntilExpand } = chart;\n    if (hiddenUntilExpand && !dashExpanded) return null;\n\n    if (type === \"accordion\") {\n      // for clarity...\n      const element = chart;\n\n      const showHide = dashExpanded ? \"Hide\" : \"Show\";\n      const caret = <b></b>;\n      return (\n        <Box\n          sx={{\n            display: \"block\",\n            width: \"100%\",\n            pt: 1,\n            pb: 2,\n            pl: 3,\n            \"& button\": { p: 0, textTransform: \"none\" },\n            \"& b\": {\n              px: 1,\n              transform: `rotate(${dashExpanded ? \"0\" : \"180\"}deg)`,\n              transition: \"transform .2s linear\",\n            },\n          }}\n        >\n          <Button onClick={toggleDashExpanded}>\n            {showHide} {element.text} {caret}\n          </Button>\n        </Box>\n      );\n    }\n\n    if (type === \"link\") {\n      // for clarity...\n      const element = chart;\n      const country = countries.find((c) => c.iso === selectedIso);\n\n      const url = _.get(country, element.elementId);\n      console.log(chart);\n      return (\n        <Box\n          sx={{\n            display: \"block\",\n            width: \"100%\",\n            pt: 1,\n            pb: 2,\n            pl: 3,\n          }}\n        >\n          <Link target=\"_blank\" rel=\"noopener noreferrer\" href={url}>\n            {element.text}\n          </Link>\n        </Box>\n      );\n    }\n\n    // if (type === \"text\") {\n    if (chartId === \"intro\") {\n      return (\n        <Box\n          sx={{\n            // background: { xs: \"red\", sm: \"blue\", md: \"green\", lg: \"yellow\", xl: \"purple\" },\n            flexBasis: { xs: \"100%\", xl: 600 },\n            flexGrow: { xl: 0 },\n            p: 3,\n            // display: {md: \"flex\"},\n          }}\n          key={chartId}\n        >\n          {getIntro(chart)}\n        </Box>\n      );\n    }\n\n    if (type === \"table\" || type === \"table_list\") {\n      return (\n        <Box sx={{ flexBasis: \"100%\", maxWidth: 864, p: 3 }} key={chartId}>\n          <Typography variant=\"h5\" component=\"h3\">\n            {name}\n          </Typography>\n          {getTable(chart)}\n        </Box>\n      );\n    }\n\n    if (type === \"nested\") {\n      return (\n        <>\n          <Box\n            sx={{\n              flexBasis: { xs: \"100%\", xl: 700 },\n              flexGrow: { xl: 1 },\n              flexShrink: { xl: 1 },\n              mr: \"auto\",\n              ml: { xl: \"auto\" },\n              maxWidth: 864,\n              p: 3,\n            }}\n            key={chartId}\n          >\n            <Typography pb={3} variant=\"h5\" component=\"h3\">\n              {name}\n            </Typography>\n            {getNested(chart)}\n          </Box>\n          <Box sx={{ flexBasis: \"100%\", height: 0 }} />\n        </>\n      );\n    }\n    // if (chart.type === \"area\") return getAreaChart(chart);\n    if (type && type !== \"line\") {\n      console.warn(\"Unknown type: \", type);\n      return null;\n    }\n\n    return (\n      <Box\n        key={chartId}\n        sx={{\n          width: \"100%\",\n          maxWidth: { md: \"44%\", xl: \"29%\" },\n          p: 3,\n        }}\n      >\n        <Typography variant=\"h5\" component=\"h3\">\n          {name}\n        </Typography>\n        {getLineChart(chart)}\n      </Box>\n    );\n  };\n\n  return (\n    <Box\n      display=\"flex\"\n      flexWrap=\"wrap\"\n      pt={8}\n      sx={{\n        justifyContent: { xs: \"space-evenly\", md: \"space-between\" },\n      }}\n    >\n      {chartData.map(getChart)}\n    </Box>\n  );\n};\n","import React from \"react\";\nimport Box from \"@mui/material/Box\";\nimport { Typography } from \"@mui/material\";\nimport { CMS_FIELDS } from \"../consts/data\";\nimport { transformLink } from \"../utils/display\";\n\nexport const HomePage = ({ homeCopy }) => {\n  if (!homeCopy || !homeCopy.length) return null; // TODO: spinner\n  // console.log(homeCopy, homeCopy && homeCopy[0]);\n  const tapFields = Object.keys(homeCopy[0]).filter((f) =>\n    f.startsWith(CMS_FIELDS.TAP)\n  );\n\n  const getTapList = (f) => {\n    return (\n      <Box\n        key={f}\n        sx={{\n          background: \"#f2c2b4\",\n          p: 1,\n          m: 1,\n          borderRadius: \"8px\",\n          // flexBasis: \"250px\",\n          height: \"100%\",\n        }}\n      >\n        {/* <b>{f.replace(CMS_FIELDS.TAP, \"\")}</b> */}\n        <Typography\n          variant=\"body1\"\n          sx={{\n            fontSize: { sm: \"smaller\", md: \"unset\" },\n          }}\n          variant=\"h7\"\n          component=\"h3\"\n          dangerouslySetInnerHTML={{\n            __html: f.replace(CMS_FIELDS.TAP, \"\"),\n          }}\n        />\n        <ul\n          style={{\n            // listStyle: \"none\",\n            paddingInlineStart: \"20px\",\n          }}\n        >\n          {homeCopy.map(\n            (row, i) =>\n              !!row[f] && (\n                <li key={row[f]}>\n                  <Typography\n                    variant=\"body1\"\n                    key={i}\n                    // sx={{ maxWidth: 600, margin: \"auto\" }}\n                    // pt={2}\n                    sx={{\n                      fontSize: { sm: \"smaller\", md: \"unset\" },\n                    }}\n                    // px={3}\n                    dangerouslySetInnerHTML={{\n                      __html: row[f],\n                    }}\n                  />\n                </li>\n              )\n          )}\n        </ul>\n      </Box>\n    );\n  };\n\n  return (\n    <Box sx={{\n      pt: \"72px\", // TODO constify header height\n      px: 3,\n      maxWidth: \"900px\", // TODO replace with M breakpoint\n      m: \"auto\"\n    }}>\n      <Box>\n        {homeCopy.map(\n          (row, i) =>\n            !!row[CMS_FIELDS.blurb] && (\n              <Typography\n                variant=\"body1\"\n                key={i}\n                sx={{\n                  fontSize: { sm: \"smaller\", md: \"unset\" },\n                }}\n                // sx={{ maxWidth: 600, margin: \"auto\" }}\n                pt={1}\n                // px={3}\n                dangerouslySetInnerHTML={{\n                  __html: transformLink(row[CMS_FIELDS.blurb]),\n                }}\n              />\n            )\n        )}\n      </Box>\n      <Box py={5} className=\"tap-lists-container\">\n        <Typography\n          variant=\"h6\"\n          component=\"h2\"\n          dangerouslySetInnerHTML={{\n            __html: \"Technical Assistance Providers\",\n          }}\n        />\n        <Box\n          className=\"tap-lists\"\n          sx={{\n            display: { sm: \"flex\" },\n          }}\n        >\n          {tapFields.map((f) => getTapList(f))}\n        </Box>\n      </Box>\n    </Box>\n  );\n};\n","import React from \"react\";\nimport Box from \"@mui/material/Box\";\nimport { Typography, useTheme } from \"@mui/material\";\nimport { CMS_FIELDS as M } from \"../consts/data\";\nimport { transformLink } from \"../utils/display\";\n\nexport const Dictionary = ({ dictionary }) => {\n  const theme = useTheme();\n  return (\n    <Box\n      sx={{\n        px: { xs: 3, lg: 10 },\n        mx: { lg: 5 },\n        mb: { lg: 5 },\n        py: 9,\n        mt: 9,\n        background: theme.palette.background.paper,\n\n        \"& dl\": {\n          display: \"inline-block\",\n          width: \"100%\",\n          mt: 0,\n          mb: { lg: 3 },\n          fontSize: 15,\n        },\n        \"& dd\": { ml: 0, mt: { xs: 1 }, fontSize: 13 },\n      }}\n    >\n      <Typography\n        variant=\"h6\"\n        component=\"h2\"\n        dangerouslySetInnerHTML={{\n          __html: \"Glossary\",\n        }}\n      />\n      <Box\n        sx={{\n          columnCount: { md: 2, xl: 3 },\n          columnGap: { xs: \"2rem\", lg: \"5rem\" },\n          mt: 3,\n        }}\n      >\n        {dictionary\n          .sort((a, b) => a.term.toLowerCase() > b.term.toLowerCase())\n          .map(({ [M.term]: term, [M.definition]: definition }) => {\n            return (\n              <dl key={term}>\n                <dt>\n                  <strong>{term}</strong>\n                </dt>\n                <dd>\n                  <Typography\n                    // sx={{ maxWidth: \"500px\" }}\n                    dangerouslySetInnerHTML={{\n                      __html: transformLink(definition),\n                    }}\n                  />\n                </dd>\n              </dl>\n            );\n          })}\n      </Box>\n    </Box>\n  );\n};\n","// import \"./styles.css\";\nimport React from \"react\";\nimport _ from \"lodash\";\nimport { getSiteData, getChartData } from \"../getData\";\nimport { themePrimary, radColors, getRC } from \"../consts/colors\";\nimport { Container, Paper, Typography, useTheme } from \"@mui/material\";\nimport { Header } from \"./Header\";\nimport { Charts } from \"./Charts\";\nimport { Box } from \"@mui/system\";\nimport { transformLink } from \"../utils/display\";\nimport { HomePage } from \"./HomePage\";\nimport { Dictionary } from \"./Dictionary\";\n\nconst SHOW_COLORS = false;\n\nexport default function App() {\n  const [selectedIso, setIso] = React.useState(null);\n  const [chartData, setChartData] = React.useState([]);\n\n  const [dictionary, setDictionary] = React.useState([]);\n  const [countries, setCountries] = React.useState([]);\n  const [homeCopy, setHomeCopy] = React.useState([]);\n  const [chartIds, setChartIds] = React.useState([]);\n  const [chartConfigsMap, setChartConfigsMap] = React.useState(null);\n\n  const [dashExpanded, setDashExpanded] = React.useState(false);\n  const toggleDashExpanded = () => setDashExpanded(!dashExpanded);\n\n  // on page load, get site-wide data\n  React.useEffect(() => {\n    getSiteData().then((result) => {\n      setDictionary(result.dictionary.filter((d) => d.term && d.definition));\n      setCountries(result.countries.filter((c) => c.iso && c.name));\n      setHomeCopy(result.homecopy);\n      setChartIds(result.chartIds);\n      setChartConfigsMap(result.chartConfigsMap);\n    });\n  }, []);\n\n  // on country selection change, get country-specific chart data\n  React.useEffect(() => {\n    if (!selectedIso) return;\n    getChartData({ chartConfigsMap, chartIds, selectedIso }).then((result) => {\n      console.log(\"@@@ ALL DATA: \");\n      console.log(result.charts);\n      setChartData(result.charts);\n    });\n  }, [selectedIso]);\n\n  const updateCountry = (e) => {\n    const value = e.target.value;\n    const realIso = _.some(countries, ({ iso }) => iso === value);\n    setIso(realIso ? value : null);\n  };\n\n  // console.log(\"*\", chartData);\n  const loading = !_.some(chartData, (c) => c && c.countryIso === selectedIso);\n\n  const theme = useTheme();\n  return (\n    <Paper\n      elevation={0}\n      sx={{\n        // keep in sync with index.html background\n        background: getRC(themePrimary, 3),\n        color: getRC(themePrimary, 12),\n        fontFamily: theme.typography.fontFamily,\n        p: { lg: 6 },\n      }}\n    >\n      <Header\n        countries={countries}\n        handleCountryChange={updateCountry}\n        selectedIso={selectedIso}\n      />\n      <br />\n\n      {!selectedIso ? (\n        <HomePage homeCopy={homeCopy} />\n      ) : loading ? (\n        <Box pt={\"50vh\"}>\n          <Typography\n            variant=\"body1\"\n            sx={{ textAlign: \"center\" }}\n            dangerouslySetInnerHTML={{\n              __html: \"loading...\",\n            }}\n          />\n        </Box>\n      ) : (\n        <Charts\n          countries={countries}\n          selectedIso={selectedIso}\n          chartData={chartData}\n          dashExpanded={dashExpanded}\n          toggleDashExpanded={toggleDashExpanded}\n        />\n      )}\n      {!!dictionary.length && !loading && dashExpanded && (\n        <Dictionary dictionary={dictionary} />\n      )}\n      {SHOW_COLORS &&\n        radColors.map((rc) => (\n          <>\n            <br></br>\n            {_.map(Object.keys(radColors[0]), (meh, idx) => (\n              <span\n                style={{\n                  background: getRC(rc, idx + 1),\n                  height: \"70px\",\n                  width: \"70px\",\n                  display: \"inline-block\",\n                  textAlign: \"center\",\n                }}\n              >\n                {idx + 1}\n              </span>\n            ))}\n            {Object.keys(rc)[0].replace(/\\d/, \"\")}\n          </>\n        ))}\n    </Paper>\n  );\n}\n","import { render } from \"react-dom\";\n\nimport App from \"./components/App\";\nimport { ThemeProvider, createTheme } from '@mui/material/styles';\nimport { getRC, themePrimary, themeSecondary } from \"./consts/colors\";\n// import { red } from '@mui/material/colors';\n\nconst theme = createTheme({\n  palette: {\n    primary: {\n      main: getRC(themePrimary, 11),\n    },\n    secondary: {\n      main: getRC(themeSecondary, 8),\n    },\n  },\n  typography: {\n    fontFamily: [\n      'Archivo',\n      'sans-serif',\n    ].join(','),\n  },\n});\n\nfunction ThemedApp() {\n  return <ThemeProvider theme={theme}><App /></ThemeProvider>;\n}\n\n\nconst rootElement = document.getElementById(\"root\");\nrender(<ThemedApp />, rootElement);\n","import _ from \"lodash\";\n\nexport const capValue = (v, options = {}) => {\n  v = Number(v);\n  // !_.isEmpty(options) && console.log(\"cvOPTIONS: \", v, options);\n  if (options.cap) return Math.min(v, Number(options.cap));\n  return v;\n};\n\nexport const displayPercent = (v, options = {}) => {\n  // !_.isEmpty(options) && console.log(\"OPTIONS: \", v, options);\n  v = Number(v);\n  if (!isFinite(v)) return \"NA\";\n  if (options.cap && v > Number(options.cap)) {\n    const x = `>${options.cap}%`;\n    // console.log(\"!!!!\", x, v, options.cap);\n    return x;\n  }\n  if (v > 100) console.warn(\"Incorrect %\");\n\n  const decimals = options.decimals || 0;\n  return _.round(v, decimals).toString() + \"%\";\n};\n\nexport const displayNumber = (v, options = {}) => {\n  v = Number(v);\n  if (options.coarseFormatting) {\n    if (v > 1000000000) {\n      return _.round(v / 1000000000, 1).toString() + \" billion\";\n    } else if (v > 1000000) {\n      return _.round(v / 1000000, 1).toString() + \" million\";\n    } else if (v < 100) {\n      return \"<100\";\n    } else if (v < 200) {\n      return \"<200\";\n    } else if (v < 500) {\n      return \"<500\";\n    } else if (v < 1000) {\n      return \"<1000\";\n    } else {\n      v = Number(v.toPrecision(2));\n    }\n  }\n\n  // insert spaces rather than commas\n  return v.toString().replace(/(\\d)(?=(\\d{3})+(?!\\d))/g, \"$1 \");\n};\n\nexport const transformLink = (t) =>\n  t.replaceAll(\"<a \", \"<a target='_blank' rel='noopener noreferrer'\");\n","// export CONSTS\nexport const DISABLED = false;\nexport const PRE_LOAD_DATA = true;\nexport const TABLE_DELIN = \"__\";\nexport const MULTI_LINE_TEXT_DELIN = \"__\";\n\n// sheets we can just grab copy directly from\nexport const CMS_SHEETS = [\"dictionary\", \"countries\", \"homecopy\"];\n// these are set in the home sheet for version controlability\nexport const CONFIGURABLE_GID_NAMES = [\"configs\", ...CMS_SHEETS];\n// gids pointing to Sheet tabs\nexport const GID_MAP = {\n  home: \"0\",\n  // configs: null,\n  // dictionary: null,\n  // countries: null,\n  // homepage: null,\n};\n\n// now extracted from chart configs sheet\n// export const chartIds = [\n//   \"p95\",\n//   \"plhiv_diagnosis\",\n//   \"late_hiv\",\n//   \"plhiv_art\",\n//   \"new_art\",\n//   \"plhiv_suppressed\",\n//   \"testing_coverage\",\n//   \"key_populations\",\n//   \"policy_compliance\",\n// ];\n\n// MAPS TO SPREADSHEET COLUMN NAMES:\n// CONFIG SHEET - identifier fields (ie non-data fields)\nexport const CONFIG_FIELDS = {\n  chartId: \"chart_id\",\n  sourceGid: \"source_gid\",\n  element: \"element\",\n  displayName: \"display_name\",\n  hiddenUntilExpand: \"hidden_until_expand\",\n  capPercentage: \"cap_percentage\",\n  percentageDecimals: \"percentage_decimals\",\n  coarseIntegerFormatting: \"coarse_integer_formatting\",\n  colorOverride: \"color_override\",\n  chartType: \"chart_type\",\n  modelled: \"modelled\",\n  formula: \"formula\",\n  hidden: \"hidden\",\n  valueField: \"value_field\",\n  percentage: \"percentage\",\n};\n\n// DATA SHEETS - data fields (fields that configs can filter by)\nexport const DATA_FIELDS = {\n  // we preserve snake_case as a reminder that these are essentially database fields\n  country_iso_code: \"country_iso_code\",\n  sourceYear: \"source_year\",\n  value: \"value\",\n  year: \"year\",\n  indicator: \"indicator\",\n  indicator_description: \"indicator_description\",\n  sex: \"sex\",\n  age: \"age\",\n  population_segment: \"population_segment\",\n  population_sub_group: \"population_sub_group\",\n  country_name: \"country_name\",\n  area_name: \"area_name\",\n  geographic_scope: \"geographic_scope\",\n  value_upper: \"value_upper\",\n  value_lower: \"value_lower\",\n  value_comment: \"value_comment\",\n  unit_format: \"unit_format\",\n  source_organization: \"source_organization\",\n  source_database: \"source_database\",\n  source_display: \"source_display\",\n  notes: \"notes\",\n  modality: \"modality\",\n  modality_category: \"modality_category\",\n  import_file: \"import_file\",\n  import_timestamp: \"import_timestamp\",\n  row_id: \"row_id\",\n  suppressed: \"suppressed\",\n  Deliverable: \"Deliverable\",\n  Supplier: \"Supplier\",\n\n  REGEX: {\n    quarter: /Q\\d\\s\\d{4}/,\n  },\n};\n\n// values in the config Sheet that hold special meanings\n// see also SPECIAL_FILTERS_MAP\nexport const SPECIAL_VALUES = {\n  all: \"all\",\n  _page_element_: \"_page_element_\",\n  _key_: \"_key_\",\n  _color_by_: \"_color_by_\",\n  link_url: \"link_url\",\n};\n\n// fields used in the \"cms\" sheets (countries, dictionary, etc)\nexport const CMS_FIELDS = {\n  // dictionary\n  term: \"term\",\n  definition: \"definition\",\n  // countries\n  iso: \"iso\",\n  name: \"name\",\n  // homecopy\n  blurb: \"blurb\",\n  TAP: \"_TAP_\", // prefix to fields for the Technical Assistance Provider fields\n};\n\n// GENERATED FIELDS - fields we add for the app\nexport const GENERATED_FIELDS = {\n  // we use UPPER_CASE to distinguish from actual \"database\" fields from the Sheet\n  DISPLAY_NAME: \"DISPLAY_NAME\",\n  DISPLAY_VALUE: \"DISPLAY_VALUE\",\n  DISPLAY_VALUE_LOWER: `DISPLAY_${DATA_FIELDS.value_lower.toUpperCase()}`,\n  DISPLAY_VALUE_UPPER: `DISPLAY_${DATA_FIELDS.value_upper.toUpperCase()}`,\n};\n"],"sourceRoot":""}